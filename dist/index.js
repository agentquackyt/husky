var a={allowHTTP:!0,allowWS:!0,allowError:!0,allowInfo:!0},h={http:(e)=>{if(a.allowHTTP==!0)console.log(r.yellow+e.method+r.reset+" "+e.url)},error:(e)=>{if(a.allowError)console.log(r.bold+r.red+"ERROR: "+r.reset+e)},info:(e)=>{if(a.allowInfo)console.log(r.bold+r.blue+"[info] "+r.reset+e)},ws:(e)=>{if(a.allowWS)console.log(r.bold+r.green+"WS "+r.reset+e)},validation:(e)=>{if(a.allowHTTP)console.log(r.bold+r.magenta+"[Validation] "+r.reset+e)},debug:(e)=>{if(!a)return;console.log(r.bold+r.magenta+"[debug] "+r.reset),Object.keys(e).forEach((t)=>{console.log(t+": "+JSON.stringify(e[t]))})},center:(e,t=!1)=>{let i=Math.floor((70-e.length)/2),s="";for(let u=0;u<i;u++)s+=t?"-":" ";console.log(s+e+s)},printProgress:(e)=>{process.stdout.clearLine(0),process.stdout.cursorTo(0),process.stdout.write(e+"%")},config:(e)=>{a=e}},r={red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m",reset:"\x1B[0m",red_bg:"\x1B[41m",green_bg:"\x1B[42m",yellow_bg:"\x1B[43m",blue_bg:"\x1B[44m",magenta_bg:"\x1B[45m",cyan_bg:"\x1B[46m",white_bg:"\x1B[47m",bold:"\x1B[1m",underline:"\x1B[4m",inverse:"\x1B[7m",hidden:"\x1B[8m",strikethrough:"\x1B[9m"};class l{routerList;port;server;tlsConfig;constructor(e){if(this.routerList=[],this.handleRequest=this.handleRequest.bind(this),e!==void 0){if(this.port=e.port!==void 0?e.port:Bun.env.PORT||0,e.logging!==void 0)h.config(e.logging);if(e.httpsConfig!==void 0)this.tlsConfig=e.httpsConfig}else this.port=Bun.env.PORT||0}use(e){this.routerList.push(e)}start({port:e,callback:t}={}){if(this.server=Bun.serve({port:e||this.port,fetch:this.handleRequest,tls:this.tlsConfig||void 0}),t!==void 0)t(this.server.port);return this.server}handleRequest(e){h.http(e);const t=new URL(e.url).pathname;for(let n of this.routerList)if(t.startsWith(n.getBaseRoute)||t.startsWith(n.getBaseRoute.slice(0,-1))){const i=n.run(e);if(i!==void 0)return i}return h.error("Fallback to default 404"),new Response(JSON.stringify({error:"Not found"}),{status:404})}}var y;((s)=>{s.GET="GET";s.POST="POST";s.PUT="PUT";s.DELETE="DELETE"})(y||={});class f{route;onError;middleware;routes;constructor(e,t){if(!e.endsWith("/"))e=e+"/";if(this.route=e,t!=null)this.onError=t;this.routes=[]}get getBaseRoute(){return this.route}run(e){let t=new URL(e.url).pathname;t=t.replace(this.route,"");let n=t.split("/");if(t.endsWith("/"))n.pop();for(let i=0;i<this.routes.length;i++){const s=this.routes[i],u=y[e.method];if(s.route[0]==""&&n.length==0)return s.callback(e);if(n.length!=s.route.length&&n[0]!="")continue;let b=!0,R={};for(let p=0;p<s.route.length;p++){const c=s.route[p];if(c.startsWith(":")&&n[p]!=""){R[c.slice(1)]=n[p];continue}if(c!=n[p])b=!1}if(!b)continue;if(s.method===void 0||s.method===u){if(this.middleware!=null)return this.middleware(e,()=>s.callback(e,R));return s.callback(e,R)}}if(this.onError!=null)return this.onError(e)}use(e){return this.middleware=e,this}get(e,t){if(e.startsWith("/"))e=e.slice(1);return this.routes.push({route:e.split("/"),callback:t,method:"GET"}),this}post(e,t){if(e.startsWith("/"))e=e.slice(1);return this.routes.push({route:e.split("/"),callback:t,method:"POST"}),this}put(e,t){if(e.startsWith("/"))e=e.slice(1);return this.routes.push({route:e.split("/"),callback:t,method:"PUT"}),this}delete(e,t){if(e.startsWith("/"))e=e.slice(1);return this.routes.push({route:e.split("/"),callback:t,method:"DELETE"}),this}}function d(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function E(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n=e.length%4===0?"":"=".repeat(4-e.length%4),i=t+n;return atob(i)}var o={settings:{secret:Bun.env.JWT_SECRET||"secret",algorithm:"sha256"},sign:(e)=>{let t=d(JSON.stringify({alg:o.settings.algorithm,typ:"JWT"})),n=d(JSON.stringify(e));const i=new Bun.CryptoHasher("sha256");i.update(t+"."+n),i.update(o.settings.secret);let s=d(i.digest("base64"));return`${t}.${n}.${s}`},verify:(e)=>{let[t,n,i]=e.split("."),s=new Bun.CryptoHasher("sha256");s.update(t+"."+n),s.update(o.settings.secret);let u=d(s.digest("base64"));return i===u},payloadFromToken:(e)=>{let t=e.split(".")[1];return JSON.parse(E(t))},verifyJWT:async(e)=>{const t={};if(e.headers.get("cookie")?.split(";").forEach((n)=>{let[i,s]=n.split("=");t[i.trim()]=s}),t.token==null)return!1;return o.verify(t.token)},middleware:(e)=>async(t,n)=>{if(await o.verifyJWT(t)==!1)return Response.redirect(e);return n()}};var k={Husky:l,Router:f,JWT:o,Console:{Output:h,Color:r}};export{k as default};
